
## ğŸ“¡ 1. ì—°ê²° ì •ë³´ (Connection Specs)

### Device Info
* **Device Name**: `MCW` (Wand) / `MCB` (Box)
* **Service UUID**: `57420001-587e-48a0-974c-544d6163c577` (Magic íŒ¨í„´)
    * *Note*: íŒì›¨ì–´ ë²„ì „ì— ë”°ë¼ `57420001-587e-48a0-974c-54686f72c577` (Thor íŒ¨í„´)ì¼ ìˆ˜ ìˆìŒ.

### Characteristics
| Channel | UUID Pattern | Properties | ì—­í•  |
| :--- | :--- | :--- | :--- |
| **CH1 (Command)** | `...0002...` | Write, Notify | ëª…ë ¹ì–´ ì†¡ì‹  (TX) ë° ìƒíƒœ ì‘ë‹µ |
| **CH2 (Stream)** | `...0003...` | Notify | ì„¼ì„œ ë°ì´í„° ë° ì´ë²¤íŠ¸ ìˆ˜ì‹  (RX) |

---

## ğŸš€ 2. ì´ˆê¸°í™” ë° ì •ë³´ íšë“ ì‹œí€€ìŠ¤ (Initialization Sequence)

ì—°ê²° ì§í›„ ì¥ì¹˜ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ì„¼ì„œë¥¼ í™œì„±í™”í•˜ëŠ” í‘œì¤€ ì ˆì°¨ì…ë‹ˆë‹¤.

### Phase 1: ì—°ê²° í™•ì¸ ë° ì¥ì¹˜ ì •ë³´ íšë“

| ìˆœì„œ | ë°©í–¥ | íŒ¨í‚· (Hex) | Protocol | ì„¤ëª… |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `TX` | `10:01` | **Keep-Alive** | ì—°ê²° ìœ ì§€ë¥¼ ìœ„í•œ í•˜íŠ¸ë¹„íŠ¸ ìš”ì²­ |
| 2 | `RX` | `10:01` | **Alive ACK** | ì¥ì¹˜ ì •ìƒ ìƒíƒœ ì‘ë‹µ |
| 3 | `TX` | `00` | **Get Status** | íŒì›¨ì–´ ìƒíƒœ/ë²„ì „ ì½”ë“œ ìš”ì²­ |
| 4 | `RX` | `00:00:03` | **Status Resp** | ìƒíƒœ ì½”ë“œ ì‘ë‹µ (03) |
| 5 | `TX` | `08` | **Get MAC** | ì¥ì¹˜ ê³ ìœ  MAC ì£¼ì†Œ ìš”ì²­ |
| 6 | `RX` | `08:fe:7d...` | **MAC Resp** | MAC ì£¼ì†Œ ë°ì´í„° (Little Endian) |
| 7 | `TX` | `09` | **Get Pair MAC** | í˜ì–´ë§ëœ Box ì£¼ì†Œ ìš”ì²­ |
| 8 | `RX` | `09:e1:d0...` | **Pair Resp** | Box MAC ì£¼ì†Œ ë°ì´í„° |
| 9 | `TX` | `0e:01` | **Get Serial** | ì‹œë¦¬ì–¼ ë²ˆí˜¸ ìš”ì²­ |
| 10 | `RX` | `0e:01:fd...` | **Serial Resp** | ì‹œë¦¬ì–¼ ë²ˆí˜¸ (uint32) |
| 11 | `TX` | `0e:02` | **Get SKU** | ì œí’ˆ SKU ìš”ì²­ |
| 12 | `RX` | `0e:02:38...` | **SKU Resp** | SKU ë¬¸ìì—´ (ì˜ˆ: "8839...") |
| 13 | `TX` | `0e:04` | **Get Device ID** | ê³ ìœ  ì¥ì¹˜ ID ë¬¸ìì—´ ìš”ì²­ |
| 14 | `RX` | `0e:04:57...` | **Dev ID Resp** | ì¥ì¹˜ ID (ì˜ˆ: "WBMC22...") |
| 15 | `TX` | `0e:09` | **Get Wand Type** | ì§€íŒ¡ì´ ëª¨ë¸ íƒ€ì… ìš”ì²­ |
| 16 | `RX` | `0e:09:73...` | **Type Resp** | ëª¨ë¸ íƒ€ì… ID/ë¬¸ìì—´ |

### Phase 2: ì„¼ì„œ í™œì„±í™” (IMU Start)

ê°€ì¥ ì¤‘ìš”í•œ ë‹¨ê³„ì…ë‹ˆë‹¤. ì´ ëª…ë ¹ì„ ë³´ë‚´ì•¼ ì»¤ì„œ ì´ë™ì„ ìœ„í•œ ë°ì´í„°ê°€ ë“¤ì–´ì˜µë‹ˆë‹¤.

| ìˆœì„œ | ë°©í–¥ | íŒ¨í‚· (Hex) | Protocol | ì„¤ëª… |
| :--- | :--- | :--- | :--- | :--- |
| 17 | `TX` | `30:00:80` | **IMU Start** | **ëª¨ì…˜ ì„¼ì„œ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘**<br>(ì´í›„ `2C` í—¤ë”ì˜ ê³ ì† ë°ì´í„° ìˆ˜ì‹ ë¨) |

### Phase 3: ë²„íŠ¼ ê°ë„ ì„¤ì • (Set Thresholds)

ì •ì „ì‹ í„°ì¹˜ ë²„íŠ¼ì˜ ë¯¼ê°ë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (ê°’ `07`=ë¯¼ê°í•¨, `0A`=ë³´í†µ)

| ìˆœì„œ | ë°©í–¥ | íŒ¨í‚· (Hex) | Protocol | ì„¤ëª… |
| :--- | :--- | :--- | :--- | :--- |
| 18 | `TX` | `dc:00:07` | **Set Touch 1** | ë²„íŠ¼ 1 ëˆ„ë¦„ ê°ë„ (07) |
| 19 | `TX` | `dc:01:07` | **Set Touch 2** | ë²„íŠ¼ 2 ëˆ„ë¦„ ê°ë„ (07) |
| 20 | `TX` | `dc:02:07` | **Set Touch 3** | ë²„íŠ¼ 3 ëˆ„ë¦„ ê°ë„ (07) |
| 21 | `TX` | `dc:03:07` | **Set Touch 4** | ë²„íŠ¼ 4 ëˆ„ë¦„ ê°ë„ (07) |
| 22 | `TX` | `dc:04:0a` | **Set Release 1** | ë²„íŠ¼ 1 ë—Œ ê°ë„ (0A) |
| 23 | `TX` | `dc:05:0a` | **Set Release 2** | ë²„íŠ¼ 2 ë—Œ ê°ë„ (0A) |
| 24 | `TX` | `dc:06:0a` | **Set Release 3** | ë²„íŠ¼ 3 ë—Œ ê°ë„ (0A) |
| 25 | `TX` | `dc:07:0a` | **Set Release 4** | ë²„íŠ¼ 4 ë—Œ ê°ë„ (0A) |

### Phase 4: ì´ˆê¸° ìƒíƒœ ì ê²€ (Status Check)

ì„¤ì • í›„ í˜„ì¬ ëˆŒë ¤ìˆëŠ” ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

| ìˆœì„œ | ë°©í–¥ | íŒ¨í‚· (Hex) | Protocol | ì„¤ëª… |
| :--- | :--- | :--- | :--- | :--- |
| 26 | `TX` | `dd:00` | **Check Status** | ë²„íŠ¼ 0~1ë²ˆ ì„¼ì„œ ìƒíƒœ ì¡°íšŒ |
| 27 | `RX` | `10:00` | **Status Report** | í˜„ì¬ ìƒíƒœ (`00`=ëˆŒë¦¼ ì—†ìŒ) |
| ... | ... | ... | ... | ... |
| 33 | `TX` | `dd:07` | **Check Status** | ë²„íŠ¼ 4ë²ˆ ì„¼ì„œ ìƒíƒœ ì¡°íšŒ |

---

## ğŸ› ï¸ 3. ìƒì„¸ í”„ë¡œí† ì½œ ì •ì˜ (Protocol Details)

### ğŸ“¤ ì†¡ì‹  ëª…ë ¹ì–´ (TX: App â†’ Wand)

#### 1. Keep Alive (Heartbeat)
* **Opcode**: `0x01` (ë˜ëŠ” `10 01` íŒ¨í„´ ì‚¬ìš©)
* **ì£¼ê¸°**: ì•½ 5ì´ˆë§ˆë‹¤ ì „ì†¡ ê¶Œì¥.

#### 2. IMU Start (Motion Sensor)
* **Packet**: `[ 0x30, 0x00, 0x80 ]`
* **ì„¤ëª…**: ìì´ë¡œ/ê°€ì†ë„ ì„¼ì„œ ë°ì´í„°ë¥¼ `20ms` ê°„ê²©ìœ¼ë¡œ ì „ì†¡ ì‹œì‘.
* **ì£¼ì˜**: ë°°í„°ë¦¬ ì†Œëª¨ê°€ í¬ë¯€ë¡œ í•„ìš”í•  ë•Œë§Œ í™œì„±í™”.

#### 3. Set Threshold (Sensitivity)
* **Opcode**: `0xDC`
* **Format**: `[ 0xDC, Index, Value ]`
* **Index**:
    * `00~03`: Touch Threshold (ëˆ„ë¥¼ ë•Œ)
    * `04~07`: Release Threshold (ë—„ ë•Œ)

#### 4. Read Status
* **Opcode**: `0xDD`
* **Format**: `[ 0xDD, Index ]`
* **ì„¤ëª…**: í•´ë‹¹ ì¸ë±ìŠ¤(ì„¼ì„œ)ì˜ í˜„ì¬ ìƒíƒœë¥¼ `0x10` ì´ë²¤íŠ¸ íŒ¨í‚·ìœ¼ë¡œ ì‘ë‹µ ìš”ì²­.

---

### ğŸ“¥ ìˆ˜ì‹  ë°ì´í„° (RX: Wand â†’ App)

#### 1. Button Event / Status
* **Opcode**: `0x10` (ì¤‘ìš”: ê¸°ì¡´ ì½”ë“œì˜ `0x11` ì•„ë‹˜)
* **Format**: `[ 0x10, Mask ]`
* **Bit Mask**:
    * `0x01`: Button 1 (Big)
    * `0x02`: Button 2
    * `0x04`: Button 3
    * `0x08`: Button 4
* **ì˜ˆì‹œ**: `10 09` -> ë²„íŠ¼ 1ê³¼ 4ê°€ ë™ì‹œì— ëˆŒë¦¼ (`01` | `08`).

#### 2. IMU Data Stream
* **Header**: `0x2C`
* **Length**: 235 Bytes (ê°€ë³€ì ì¼ ìˆ˜ ìˆìœ¼ë‚˜ ë¡œê·¸ìƒ ê³ ì •)
* **êµ¬ì„±**: ë‹¤ìˆ˜ì˜ Motion Data Chunkê°€ í¬í•¨ë¨.

#### 3. Info Response
* **Opcode**: `0x0E`
* **Format**: `[ 0x0E, Type, Data... ]`
* **Type**:
    * `0x01`: Serial Number (Int)
    * `0x04`: Device ID (String)
    * `0x09`: Wand Type (Int/String)

---

    elif opcode == 0x2C:
        # IMU Data handling
        pass
